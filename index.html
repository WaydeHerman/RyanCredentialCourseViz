<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Demo</title>
    <style>
      .start-screen {
        top: 240px;
        left: 100px;
        position: relative;
      }
      .node {
        stroke: #4c5b5c;
        stroke-width: 3px;
        fill: white;
        cursor: pointer;
      }

      .node-label {
        text-align: center;
        text-anchor: middle;
        font-family: Arial;
        font-weight: bold;
        font-size: 0.7em;
      }

      .node-label-key {
        text-align: center;
        text-anchor: middle;
        font-family: Arial;
        font-weight: bold;
        font-size: 0.9em;
      }

      /* Dropdown Button */
      .dropbtn {
        background-color: #787878;
        color: white;
        padding: 10px;
        font-family: Arial;
        font-weight: bold;
        font-size: 10px;
        border: none;
        cursor: pointer;
        min-width: 150px;
        text-anchor: middle;
      }

      /* The container <div> - needed to position the dropdown content */
      .dropdown-stack-name,
      .dropdown-education-standard,
      .dropdown-topic,
      .dropdown-audience {
        display: inline-block;
        margin: auto;
        position: relative;
        text-anchor: middle;
        padding-right: 50px;
      }

      /* Dropdown Content (Hidden by Default) */
      .dropdown-content {
        display: none;
        position: absolute;
        background-color: #f1f1f1;
        min-width: 150px;
        z-index: 1;
        max-height: 400px;
        overflow: auto;
        text-anchor: middle;
      }

      /* Links inside the dropdown */
      .dropdown-content a {
        color: #404e4d;
        font-size: 10px;
        font-family: Arial;
        font-weight: bold;
        padding: 8px 0px;
        text-decoration: none;
        display: block;
        text-anchor: middle;
        text-align: center;
      }

      /* Change color of dropdown links on hover */
      .dropdown-content a:hover {
        background-color: #ddd;
      }

      /* Show the dropdown menu on hover */
      .dropdown-stack-name:hover .dropdown-content,
      .dropdown-education-standard:hover .dropdown-content,
      .dropdown-topic:hover .dropdown-content,
      .dropdown-audience:hover .dropdown-content {
        display: block;
      }

      /* Change the background color of the dropdown button when the dropdown content is shown */
      .dropdown-education-standard:hover .dropbtn,
      .dropdown-stack-name:hover .dropbtn,
      .dropdown-topic:hover .dropbtn,
      .dropdown-audience:hover .dropbtn {
        background-color: #132a54;
      }

      .back-btn {
        padding: 10px;
        background-color: gray;
        color: white;
        cursor: pointer;
        position: relative;
        left: 100px;
        font-family: Arial;
        font-weight: bold;
        text-anchor: middle;
        text-align: center;
        display: none;
      }

      .breadcrumbs-container {
        position: absolute;
        top: 60px;
        left: 40px;
        display: none;
      }

      .bitem-icon {
        display: inline-block;
        padding-left: 10px;
      }

      .bitem {
        display: inline-block;
        padding-left: 10px;
        font-family: Arial;
        font-size: 0.8em;
        cursor: pointer;
      }

      .bitem-active {
        font-weight: bold;
        cursor: default;
      }

      .bitem-inactive {
        color: #b9b9b9;
        cursor: default;
      }

      .tooltip {
        display: none;
        position: absolute;
        top: 100px;
        left: 60vw;
        padding: 10px;
        border: 2px solid black;
        font-family: arial;
        max-width: 400px;
      }

      .tooltip-name {
        font-weight: bold;
        font-size: 1.2em;
        padding-bottom: 10px;
      }
    </style>

    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script
      src="https://kit.fontawesome.com/ea2379d57d.js"
      crossorigin="anonymous"
    ></script>
  </head>

  <body>
    <div class="start-screen">
      <div class="dropdown-audience">
        <button class="dropbtn">
          <i class="arrow down"></i> Select Audience
        </button>
        <div class="dropdown-content" id="audience-selector"></div>
      </div>

      <div class="dropdown-topic">
        <button class="dropbtn"><i class="arrow down"></i> Select Topic</button>
        <div class="dropdown-content" id="topic-selector"></div>
      </div>

      <div class="dropdown-stack-name">
        <button class="dropbtn">
          <i class="arrow down"></i> Select Stack Name
        </button>
        <div class="dropdown-content" id="stack-name-selector"></div>
      </div>

      <div class="dropdown-education-standard">
        <button class="dropbtn">
          <i class="arrow down"></i> Select Education Standard
        </button>
        <div class="dropdown-content" id="education-standard-selector"></div>
      </div>
    </div>
    <div class="viz-container">
      <div class="tooltip">
        <div class="tooltip-name"></div>
        <div class="tooltip-issuing-organization"></div>
        <div class="tooltip-topic"></div>
        <div class="tooltip-audience"></div>
        <div class="tooltip-education-standard"></div>
        <div class="tooltip-stack-name"></div>
        <div class="tooltip-description"></div>
      </div>
      <div id="viz"></div>
      <div class="breadcrumbs-container">
        <i class="fas fa-home bitem-icon"></i>
        <div class="bitem bitem-0">Home</div>
        <i class="fas fa-chevron-right bitem-icon bitem-icon-1"></i>
        <div class="bitem bitem-1">Select Topic</div>
        <i class="fas fa-chevron-right bitem-icon bitem-icon-2"></i>
        <div class="bitem bitem-2">Select Audience</div>
        <i class="fas fa-chevron-right bitem-icon bitem-icon-3"></i>
        <div class="bitem bitem-3 bitem-active">Select Education Standard</div>
        <i class="fas fa-chevron-right bitem-icon bitem-icon-4"></i>
        <div class="bitem bitem-4 bitem-inactive">Select Micro-credential</div>
      </div>
    </div>

    <script>
      var width = 600,
        height = 600,
        directory = [],
        mode = "",
        audienceData,
        topicData,
        level = 0;
      d3.csv("data.csv").then(function(data) {
        console.log(data);

        breadCrumbs = [];

        new_data = [];
        data.forEach(function(v) {
          var audiences = v["Audience"].split(",");
          audiences.forEach(function(w) {
            v_copy = JSON.parse(JSON.stringify(v));
            v_copy["Audience_alt"] = w.replace(/"/g, "").trim();
            new_data.push(v_copy);
          });
        });

        data = new_data;
        new_data = [];
        data.forEach(function(v) {
          var topics = v["Topic"].split(",");
          topics.forEach(function(w) {
            v_copy = JSON.parse(JSON.stringify(v));
            v_copy["Topic_alt"] = w.replace(/"/g, "").trim();
            new_data.push(v_copy);
          });
        });

        data = new_data;
        new_data = [];
        data.forEach(function(v) {
          var stackNames = v["Micro-credential Stack Name"].split(",");
          stackNames.forEach(function(w) {
            v_copy = JSON.parse(JSON.stringify(v));
            v_copy["Micro-credential Stack Name_alt"] = w
              .replace(/"/g, "")
              .trim();
            new_data.push(v_copy);
          });
        });

        data = new_data;
        new_data = [];
        data.forEach(function(v) {
          var educationStandards = v["Education Standard"].split(",");
          educationStandards.forEach(function(w) {
            v_copy = JSON.parse(JSON.stringify(v));
            v_copy["Education Standard_alt"] = w.replace(/"/g, "").trim();
            new_data.push(v_copy);
          });
        });

        data = new_data;

        audienceData = d3
          .nest()
          .key(function(d) {
            return d["Audience_alt"];
          })
          .key(function(d) {
            return d["Topic_alt"];
          })
          .entries(data);

        topicData = d3
          .nest()
          .key(function(d) {
            return d["Topic_alt"];
          })
          .key(function(d) {
            return d["Audience_alt"];
          })
          .entries(data);

        stackNameData = d3
          .nest()
          .key(function(d) {
            return d["Micro-credential Stack Name_alt"];
          })
          .key(function(d) {
            return d["Audience_alt"];
          })
          .key(function(d) {
            return d["Topic_alt"];
          })
          .entries(data);

        educationStandardData = d3
          .nest()
          .key(function(d) {
            return d["Education Standard_alt"];
          })
          .key(function(d) {
            return d["Audience_alt"];
          })
          .key(function(d) {
            return d["Topic_alt"];
          })
          .entries(data);

        var audienceList = [];
        audienceData.forEach(function(w) {
          if (w.key !== "") {
            audienceList.push(w.key);
          }
          w.values.forEach(function(v) {
            var tmp_list = [];
            v.values.forEach(function(u, i) {
              if (tmp_list.indexOf(u["MC ID #"]) < 0) {
                tmp_list.push(u["MC ID #"]);
              } else {
                delete v.values[i];
              }
            });
          });
        });

        var topicList = [];
        topicData.forEach(function(w) {
          if (w.key !== "") {
            topicList.push(w.key);
          }
          w.values.forEach(function(v) {
            var tmp_list = [];
            v.values.forEach(function(u, i) {
              if (tmp_list.indexOf(u["MC ID #"]) < 0) {
                tmp_list.push(u["MC ID #"]);
              } else {
                delete v.values[i];
              }
            });
          });
        });

        var stackNameList = [];
        stackNameData.forEach(function(w) {
          if (w.key !== "") {
            stackNameList.push(w.key);
          }
          w.values.forEach(function(v) {
            v.values.forEach(function(u) {
              var tmp_list = [];
              u.values.forEach(function(o, i) {
                if (tmp_list.indexOf(o["MC ID #"]) < 0) {
                  tmp_list.push(o["MC ID #"]);
                } else {
                  delete u.values[i];
                }
              });
            });
          });
        });

        var educationStandardList = [];
        educationStandardData.forEach(function(w) {
          if (w.key !== "") {
            educationStandardList.push(w.key);
          }
          w.values.forEach(function(v) {
            v.values.forEach(function(u) {
              var tmp_list = [];
              u.values.forEach(function(o, i) {
                if (tmp_list.indexOf(o["MC ID #"]) < 0) {
                  tmp_list.push(o["MC ID #"]);
                } else {
                  delete u.values[i];
                }
              });
            });
          });
        });

        d3.select(".back-btn").on("click", function() {});

        var audienceSelector = d3
          .select("#audience-selector")
          .selectAll("a")
          .data(audienceList)
          .enter()
          .append("text")
          .html(function(d) {
            return "<a href='#'>" + d + "</a>";
          })
          .on("click", function(d) {
            audienceData.forEach(function(v) {
              if (v.key === d) {
                mode = "Audience";
                var data_copy = JSON.parse(JSON.stringify(v.values));
                data_copy.push(v);
                directory = [];
                directory.push(v.key);
                level += 1;
                breadCrumbs = [{ name: v.key, type: "audience", data: v }];
                generateGraph(data_copy, v.key);
              }
            });
          });

        var topicSelector = d3
          .select("#topic-selector")
          .selectAll("a")
          .data(topicList)
          .enter()
          .append("text")
          .html(function(d) {
            return "<a href='#'>" + d + "</a>";
          })
          .on("click", function(d) {
            topicData.forEach(function(v) {
              if (v.key === d) {
                mode = "Topic";
                var data_copy = JSON.parse(JSON.stringify(v.values));
                data_copy.push(v);
                directory = [];
                directory.push(v.key);
                level += 1;
                breadCrumbs = [{ name: v.key, type: "topic", data: v }];
                generateGraph(data_copy, v.key);
              }
            });
          });

        var stackNameSelector = d3
          .select("#stack-name-selector")
          .selectAll("a")
          .data(stackNameList)
          .enter()
          .append("text")
          .html(function(d) {
            return "<a href='#'>" + d + "</a>";
          })
          .on("click", function(d) {
            stackNameData.forEach(function(v) {
              if (v.key === d) {
                mode = "Stack Name";
                var data_copy = JSON.parse(JSON.stringify(v.values));
                data_copy.push(v);
                directory = [];
                directory.push(v.key);
                level += 1;
                breadCrumbs = [{ name: v.key, type: "stack", data: v }];
                generateGraph(data_copy, v.key);
              }
            });
          });

        var educationStandardSelector = d3
          .select("#education-standard-selector")
          .selectAll("a")
          .data(educationStandardList)
          .enter()
          .append("text")
          .html(function(d) {
            return "<a href='#'>" + d + "</a>";
          })
          .on("click", function(d) {
            console.log(d);
            educationStandardData.forEach(function(v) {
              if (v.key === d) {
                mode = "Education Standard";
                var data_copy = JSON.parse(JSON.stringify(v.values));
                data_copy.push(v);
                directory = [];
                directory.push(v.key);
                level += 1;
                breadCrumbs = [
                  { name: v.key, type: "education-standard", data: v }
                ];
                generateGraph(data_copy, v.key);
              }
            });
          });
      });

      function generateGraph(data, root_key) {
        updateBreadcrumbs();
        d3.select(".tooltip").style("display", "none");
        console.log(breadCrumbs);
        d3.select(".start-screen").style("display", "none");
        d3.select("#viz")
          .selectAll("*")
          .remove();
        //d3.select(".back-btn").style("display", "inline-block");

        var root_init = d3
          .stratify()
          .id(function(d) {
            return d.key;
          })
          .parentId(function(d) {
            if (d.key != root_key) {
              return root_key;
            } else {
              return "";
            }
          })(data);

        var root = d3.hierarchy(root_init);

        var transform = d3.zoomIdentity;
        let node, link;

        const svg = d3
          .select("#viz")
          .append("svg")
          .attr("width", 1000)
          .attr("height", 1000)
          .append("g")
          .attr("transform", "translate(200,200)");

        var simulation = d3
          .forceSimulation()
          .force("collision", d3.forceCollide(50))
          .force(
            "link",
            d3
              .forceLink()
              .id(function(d) {
                return d.data.id;
              })
              .distance(function(d) {
                return 80;
              })
          )
          .force("charge", d3.forceManyBody())
          .force("center", d3.forceCenter(width / 2, height / 4))
          .force("x", d3.forceX())
          .force("y", d3.forceY())
          .on("tick", ticked);

        d3.select(".bitem-0").on("click", function() {
          level = 0;
          breadCrumbs = [];
          mode = "";
          directory = [];
          updateBreadcrumbs();
          d3.select(".start-screen").style("display", "block");
          d3.select(".tooltip").style("display", "none");
          d3.select("#viz")
            .selectAll("*")
            .remove();
        });

        d3.select(".fa-home")
          .style("cursor", "pointer")
          .on("click", function() {
            level = 0;
            breadCrumbs = [];
            mode = "";
            directory = [];
            updateBreadcrumbs();
            d3.select(".start-screen").style("display", "block");
            d3.select(".tooltip").style("display", "none");
            d3.select("#viz")
              .selectAll("*")
              .remove();
          });

        d3.select(".bitem-1").on("click", function() {
          level = 0;
          breadCrumbs = [];
          mode = "";
          directory = [];
          updateBreadcrumbs();
          d3.select(".start-screen").style("display", "block");
          d3.select(".tooltip").style("display", "none");
          d3.select("#viz")
            .selectAll("*")
            .remove();
        });

        d3.select(".bitem-2").on("click", function() {
          level = 1;
          breadCrumbs = breadCrumbs.slice(0, 1);
          directory = directory.slice(0, 1);
          console.log(breadCrumbs);
          if (mode === "Audience") {
            audienceData.forEach(function(v) {
              if (v.key === breadCrumbs[0].name) {
                var data_copy = JSON.parse(JSON.stringify(v.values));
                data_copy.push(v);
                generateGraph(data_copy, v.key);
              }
            });
          }
          if (mode === "Topic") {
            topicData.forEach(function(v) {
              if (v.key === breadCrumbs[0].name) {
                var data_copy = JSON.parse(JSON.stringify(v.values));
                data_copy.push(v);
                generateGraph(data_copy, v.key);
              }
            });
          }
          if (mode === "Stack Name") {
            stackNameData.forEach(function(v) {
              if (v.key === breadCrumbs[0].name) {
                var data_copy = JSON.parse(JSON.stringify(v.values));
                data_copy.push(v);
                generateGraph(data_copy, v.key);
              }
            });
          }
          if (mode === "Education Standard") {
            educationStandardData.forEach(function(v) {
              if (v.key === breadCrumbs[0].name) {
                var data_copy = JSON.parse(JSON.stringify(v.values));
                data_copy.push(v);
                generateGraph(data_copy, v.key);
              }
            });
          }
        });

        d3.select(".bitem-3").on("click", function() {
          level = 2;
          breadCrumbs = breadCrumbs.slice(0, 2);
          directory = directory.slice(0, 2);
          console.log(breadCrumbs);
          if (mode === "Audience") {
            //
          }
          if (mode === "Topic") {
            //
          }
          if (mode === "Stack Name") {
            stackNameData.forEach(function(v) {
              if (v.key === breadCrumbs[0].name) {
                v.values.forEach(function(u) {
                  if (u.key === breadCrumbs[1].name) {
                    var data_copy = JSON.parse(JSON.stringify(u.values));
                    data_copy.push(u);
                    generateGraph(data_copy, u.key);
                  }
                });
              }
            });
          }
          if (mode === "Education Standard") {
            educationStandardData.forEach(function(v) {
              if (v.key === breadCrumbs[0].name) {
                v.values.forEach(function(u) {
                  if (u.key === breadCrumbs[1].name) {
                    var data_copy = JSON.parse(JSON.stringify(u.values));
                    data_copy.push(u);
                    generateGraph(data_copy, u.key);
                  }
                });
              }
            });
          }
        });

        function update() {
          const nodes = flatten(root);
          const links = root.links();

          link = svg.selectAll(".link").data(links, function(d) {
            return d.target.id;
          });

          link.exit().remove();

          const linkEnter = link
            .enter()
            .append("line")
            .attr("class", "link")
            .style("stroke", function(d) {
              if (d.value > 0) {
                return "white";
              } else {
                return "#000";
              }
            })
            .style("opacity", function(d) {
              return 0.2;
            })
            .style("stroke-width", function(d) {
              if (d.value > 0) {
                return d.value / 2;
              } else {
                return 2;
              }
            });

          link = linkEnter.merge(link);

          node = svg.selectAll(".node").data(nodes, function(d) {
            return d.id;
          });

          node.exit().remove();

          const nodeEnter = node
            .enter()
            .append("g")
            .attr("class", "node")
            .style("fill", function(d) {
              if (d.data.id === root_key) {
                return "#8B8B8B";
              } else {
                if (mode === "Audience" || mode === "Topic") {
                  if (breadCrumbs.length == 2) {
                    return "#3891A6";
                  } else {
                    return "#B9B9B9";
                  }
                } else {
                  if (breadCrumbs.length == 3) {
                    return "#3891A6";
                  } else {
                    return "#B9B9B9";
                  }
                }
              }
            })
            .on("mouseover", function(d) {
              if (d.data.id !== root_key) {
                if (
                  breadCrumbs.length === 2 &&
                  (mode === "Audience" || mode === "Topic")
                ) {
                  showTooltip(d.data.data);
                }
                if (
                  breadCrumbs.length === 3 &&
                  (mode === "Stack Name" || mode === "Education Standard")
                ) {
                  showTooltip(d.data.data);
                }
              }
            })
            .on("click", function(d) {
              console.log(d);
              if (d.data.parent !== null) {
                if (mode === "Audience") {
                  if (breadCrumbs.length < 2) {
                    directory.push(d.data.id);
                    audienceData.forEach(function(v) {
                      if (v.key === directory[0]) {
                        v.values.forEach(function(w) {
                          if (w) {
                            if (w.key === directory[1]) {
                              var data_copy = JSON.parse(
                                JSON.stringify(w.values)
                              );
                              data_copy.push(w);
                              level += 1;
                              breadCrumbs.push({
                                name: w.key,
                                type: "topic",
                                data: w
                              });
                              generateGraph(
                                data_copy.filter(function(d) {
                                  return d != null;
                                }),
                                w.key
                              );
                            }
                          }
                        });
                      }
                    });
                  }
                }
                if (mode === "Topic") {
                  if (breadCrumbs.length < 2) {
                    directory.push(d.data.id);
                    topicData.forEach(function(v) {
                      if (v.key === directory[0]) {
                        v.values.forEach(function(w) {
                          if (w) {
                            if (w.key === directory[1]) {
                              var data_copy = JSON.parse(
                                JSON.stringify(w.values)
                              );
                              data_copy.push(w);
                              level += 1;
                              breadCrumbs.push({
                                name: w.key,
                                type: "audience",
                                data: w
                              });
                              generateGraph(
                                data_copy.filter(function(d) {
                                  return d != null;
                                }),
                                w.key
                              );
                            }
                          }
                        });
                      }
                    });
                  }
                }
                if (mode === "Stack Name") {
                  if (breadCrumbs.length < 3) {
                    console.log(stackNameData);
                    directory.push(d.data.id);
                    stackNameData.forEach(function(v) {
                      if (v.key === directory[0] && v.key === root_key) {
                        v.values.forEach(function(w) {
                          console.log(w);
                          if (w) {
                            if (w.key === directory[1]) {
                              var data_copy = JSON.parse(
                                JSON.stringify(w.values)
                              );
                              data_copy.push(w);
                              level += 1;
                              breadCrumbs.push({
                                name: w.key,
                                type: "audience",
                                data: w
                              });
                              generateGraph(
                                data_copy.filter(function(d) {
                                  return d != null;
                                }),
                                w.key
                              );
                            }
                          }
                        });
                      }
                      if (v.key === directory[0]) {
                        v.values.forEach(function(w) {
                          if (w.key === directory[1] && w.key === root_key) {
                            w.values.forEach(function(u) {
                              if (u.key === d.data.id) {
                                var data_copy = JSON.parse(
                                  JSON.stringify(u.values)
                                );
                                data_copy.push(u);
                                level += 1;
                                breadCrumbs.push({
                                  name: u.key,
                                  type: "topic",
                                  data: u
                                });
                                generateGraph(
                                  data_copy.filter(function(d) {
                                    return d != null;
                                  }),
                                  u.key
                                );
                              }
                            });
                          }
                        });
                      }
                    });
                  }
                }
                if (mode === "Education Standard") {
                  if (breadCrumbs.length < 3) {
                    directory.push(d.data.id);
                    educationStandardData.forEach(function(v) {
                      if (v.key === directory[0] && v.key === root_key) {
                        v.values.forEach(function(w) {
                          console.log(w);
                          if (w) {
                            if (w.key === directory[1]) {
                              var data_copy = JSON.parse(
                                JSON.stringify(w.values)
                              );
                              data_copy.push(w);
                              level += 1;
                              breadCrumbs.push({
                                name: w.key,
                                type: "audience",
                                data: w
                              });
                              generateGraph(
                                data_copy.filter(function(d) {
                                  return d != null;
                                }),
                                w.key
                              );
                            }
                          }
                        });
                      }
                      if (v.key === directory[0]) {
                        v.values.forEach(function(w) {
                          if (w.key === directory[1] && w.key === root_key) {
                            w.values.forEach(function(u) {
                              if (u.key === d.data.id) {
                                var data_copy = JSON.parse(
                                  JSON.stringify(u.values)
                                );
                                data_copy.push(u);
                                level += 1;
                                breadCrumbs.push({
                                  name: u.key,
                                  type: "topic",
                                  data: u
                                });
                                generateGraph(
                                  data_copy.filter(function(d) {
                                    return d != null;
                                  }),
                                  u.key
                                );
                              }
                            });
                          }
                        });
                      }
                    });
                  }
                }
              }
            })
            .call(
              d3
                .drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended)
            );
          //.on("mouseover", nodeMouseOver);

          nodeLabels = node
            .enter()
            .append("text")
            .attr("class", function(d) {
              if (d.data.id === root_key) {
                return "node-label-key";
              } else {
                return "node-label";
              }
            })
            .text(function(d) {
              if (d.data.id) {
                return d.data.id;
              }
              if (d.data.data["Micro-credential Name"]) {
                return d.data.data["Micro-credential Name"];
              }
            });

          nodeEnter
            .append("circle")
            .style("r", function(d) {
              if (d.data.id === root_key) {
                return 14;
              } else {
                return 10;
              }
            })
            .style("text-anchor", function(d) {
              return d.children ? "end" : "start";
            })
            .text(function(d) {
              return d.data.id;
            });

          node = nodeEnter.merge(node);
          simulation.nodes(nodes);
          simulation.force("link").links(links);
        }

        function ticked() {
          link
            .attr("x1", function(d) {
              return d.source.x;
            })
            .attr("y1", function(d) {
              return d.source.y;
            })
            .attr("x2", function(d) {
              return d.target.x;
            })
            .attr("y2", function(d) {
              return d.target.y;
            });

          node.attr("transform", function(d) {
            return `translate(${d.x}, ${d.y})`;
          });

          nodeLabels
            .attr("x", function(d) {
              return d.x;
            })
            .attr("y", function(d) {
              return d.y - 20;
            });
        }

        function showTooltip(d) {
          console.log(d);
          d3.select(".tooltip").style("display", "block");
          d3.select(".tooltip-name").text(d["Micro-credential Name"]);
          d3.select(".tooltip-issuing-organization").text(
            "Issuing Organization: " + d["Issuing Organization"]
          );
          d3.select(".tooltip-topic").text("Topic: " + d["Topic"]);
          d3.select(".tooltip-audience").text("Audience " + d["Audience"]);
          d3.select(".tooltip-education-standard").text(
            "Education Standard" + d["Education Standard"]
          );
          d3.select(".tooltip-stack-name").text(
            "Stack Name: " + d["Micro-credential Stack Name"]
          );
        }

        function updateBreadcrumbs() {
          console.log("level", level);
          if (level === 0) {
            d3.select(".breadcrumbs-container").style("display", "none");
          } else {
            d3.select(".breadcrumbs-container").style("display", "block");
            if (mode === "Audience" || mode === "Topic") {
              d3.select(".bitem-4").style("display", "none");
              d3.select(".bitem-icon-4").style("display", "none");
            } else {
              d3.select(".bitem-4").style("display", "inline-block");
              d3.select(".bitem-icon-4").style("display", "inline-block");
            }
            if (level === 1) {
              if (mode === "Audience") {
                var bitem1 = breadCrumbs[0].name;
                var bitem2 = "Select Topic";
                var bitem3 = "Select Micro-credential";
              }
              if (mode === "Topic") {
                var bitem1 = breadCrumbs[0].name;
                var bitem2 = "Select Audience";
                var bitem3 = "Select Micro-credential";
              }
              if (mode === "Stack Name") {
                var bitem1 = breadCrumbs[0].name;
                var bitem2 = "Select Audience";
                var bitem3 = "Select Topic";
                var bitem4 = "Select Micro-credential";
              }
              if (mode === "Education Standard") {
                var bitem1 = breadCrumbs[0].name;
                var bitem2 = "Select Audience";
                var bitem3 = "Select Topic";
                var bitem4 = "Select Micro-credential";
              }
              d3.select(".bitem-1")
                .attr("class", "bitem bitem-1")
                .text(bitem1);
              d3.select(".bitem-2")
                .attr("class", "bitem bitem-2 bitem-active")
                .text(bitem2);
              d3.select(".bitem-3")
                .attr("class", "bitem bitem-3 bitem-inactive")
                .text(bitem3);
              d3.select(".bitem-4").attr(
                "class",
                "bitem bitem-4 bitem-inactive"
              );
            }
            if (level === 2) {
              if (mode === "Audience") {
                var bitem1 = breadCrumbs[0].name;
                var bitem2 = breadCrumbs[1].name;
                var bitem3 = "Select Micro-credential";
              }
              if (mode === "Topic") {
                var bitem1 = breadCrumbs[0].name;
                var bitem2 = breadCrumbs[1].name;
                var bitem3 = "Select Micro-credential";
              }
              if (mode === "Stack Name") {
                var bitem1 = breadCrumbs[0].name;
                var bitem2 = breadCrumbs[1].name;
                var bitem3 = "Select Topic";
                var bitem4 = "Select Micro-credential";
              }
              if (mode === "Education Standard") {
                var bitem1 = breadCrumbs[0].name;
                var bitem2 = breadCrumbs[1].name;
                var bitem3 = "Select Topic";
                var bitem4 = "Select Micro-credential";
              }
              d3.select(".bitem-1")
                .attr("class", "bitem bitem-1")
                .text(bitem1);
              d3.select(".bitem-2")
                .attr("class", "bitem bitem-2")
                .text(bitem2);
              d3.select(".bitem-3")
                .attr("class", "bitem bitem-3 bitem-active")
                .text(bitem3);
              d3.select(".bitem-4").attr(
                "class",
                "bitem bitem-4 bitem-inactive"
              );
            }
            if (level === 3) {
              if (mode === "Stack Name") {
                var bitem1 = breadCrumbs[0].name;
                var bitem2 = breadCrumbs[1].name;
                var bitem3 = breadCrumbs[2].name;
                var bitem4 = "Select Micro-credential";
              }
              if (mode === "Education Standard") {
                var bitem1 = breadCrumbs[0].name;
                var bitem2 = breadCrumbs[1].name;
                var bitem3 = breadCrumbs[2].name;
                var bitem4 = "Select Micro-credential";
              }
              d3.select(".bitem-1")
                .attr("class", "bitem bitem-1")
                .text(bitem1);
              d3.select(".bitem-2")
                .attr("class", "bitem bitem-2")
                .text(bitem2);
              d3.select(".bitem-3")
                .attr("class", "bitem bitem-3")
                .text(bitem3);
              d3.select(".bitem-4")
                .attr("class", "bitem bitem-4 bitem-active")
                .text(bitem4);
            }
          }
        }

        function dragstarted(d) {
          if (!d3.event.active) simulation.alphaTarget(0.3).restart();
          d.fx = d.x;
          d.fy = d.y;
        }

        function dragged(d) {
          d.fx = d3.event.x;
          d.fy = d3.event.y;
        }

        function dragended(d) {
          if (!d3.event.active) simulation.alphaTarget(0);
          d.fx = null;
          d.fy = null;
        }

        function flatten(root) {
          const nodes = [];
          function recurse(node) {
            if (node.children) node.children.forEach(recurse);
            nodes.push(node);
          }
          recurse(root);
          return nodes;
        }
        update();
      }
    </script>
  </body>
</html>
